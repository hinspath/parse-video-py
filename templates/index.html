<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no"/>
    <meta name="renderer" content="webkit"/>
    <meta name="force-rendering" content="webkit"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <title>{{ title }}</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdui@1.0.0/dist/css/mdui.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/mdui@1.0.0/dist/js/mdui.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<style>
    /* === åŸæœ‰ä¸»é¢˜æ ·å¼ä¿æŒä¸å˜ === */
    /* ä¸»é¢˜é€‰æ‹©å™¨æ ·å¼ */
    .theme-selector {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        padding: 15px;
        min-width: 200px;
        transition: all 0.3s ease;
    }

    .theme-selector.collapsed {
        min-width: auto;
        padding: 10px;
    }

    .theme-toggle {
        display: flex;
        align-items: center;
        justify-content: space-between;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
    }

    .theme-toggle:hover {
        color: #666;
    }

    .theme-options {
        margin-top: 12px;
        display: none;
    }

    .theme-selector:not(.collapsed) .theme-options {
        display: block;
    }

    .theme-option {
        display: flex;
        align-items: center;
        padding: 8px 12px;
        margin: 4px 0;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .theme-option:hover {
        background: #f5f5f5;
    }

    .theme-option.active {
        background: #e3f2fd;
        font-weight: 500;
    }

    .theme-preview {
        width: 20px;
        height: 20px;
        border-radius: 4px;
        margin-right: 10px;
        border: 1px solid #ddd;
    }

    .theme-name {
        flex: 1;
    }

    .theme-designer {
        font-size: 11px;
        opacity: 0.7;
        margin-left: 5px;
    }

    /* åŸå§‹ä¸»é¢˜ - MDUIé£æ ¼ */
    .theme-original {
        background-image: linear-gradient(135deg, #CE9FFC 10%, #7367F0 100%);
        opacity: 0.3;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: -1;
        content: "";
    }

    body.theme-original::before {
        background-image: linear-gradient(135deg, #CE9FFC 10%, #7367F0 100%);
        opacity: 0.3;
        z-index: -1;
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
    }

    .theme-original ::selection {
        background: rgba(0, 149, 255, .1);
    }

    /* Dieter Rams æç®€åŠŸèƒ½ä¸»ä¹‰ä¸»é¢˜ */
    body.theme-rams {
        background: #f8f8f8;
        color: #000000;
        font-family: 'SF Pro Display', 'Helvetica Neue', 'Arial', sans-serif;
        font-weight: 400;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        overflow-x: hidden;
    }
    body.theme-rams::before {
        background:
            linear-gradient(45deg, rgba(0,122,255,0.02) 0%, transparent 50%),
            linear-gradient(-45deg, rgba(255,149,0,0.01) 0%, transparent 50%);
        background-size: 400px 400px;
        animation: ramsSubtleFlow 20s ease-in-out infinite;
        pointer-events: none;
        z-index: -1;
    }
    @keyframes ramsSubtleFlow {
        0%, 100% { background-position: 0% 0%, 100% 100%; }
        50% { background-position: 100% 0%, 0% 100%; }
    }
    body.theme-rams .mdui-container {
        max-width: 95vw;
        width: 100%;
        min-width: 320px;
        margin: 60px auto;
        padding: 0 20px;
        position: relative;
        z-index: 2;
    }
    body.theme-rams .mdui-card {
        background: #ffffff;
        border: 1px solid #d1d1d1;
        box-shadow: 0 4px 6px rgba(0,0,0,0.04), 0 1px 3px rgba(0,0,0,0.06);
        opacity: 1;
        border-radius: 12px;
        padding: 40px;
        margin: 0;
        position: relative;
        transition: all 0.3s ease;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
        margin-bottom: 20px; /* å¢åŠ åº•éƒ¨é—´è· */
    }
    body.theme-rams .mdui-card:hover::before { opacity: 0.1; }
    body.theme-rams .mdui-img-circle {
        width: 60px !important;
        height: 60px !important;
        border: 2px solid #e5e5e7;
        border-radius: 50%;
        margin: 0 auto 30px auto;
        display: block;
        background: #ffffff;
        padding: 4px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08), 0 0 0 1px rgba(0,122,255,0.1);
        transition: all 0.3s ease;
    }
    body.theme-rams h1 {
        font-size: 28px;
        font-weight: 700;
        color: #1d1d1f;
        margin: 0 0 32px 0;
        text-align: center;
        letter-spacing: -0.6px;
        line-height: 1.1;
        position: relative;
    }
    body.theme-rams .mdui-btn {
        background: #007aff;
        color: #ffffff;
        border: none;
        border-radius: 10px;
        text-transform: none;
        font-weight: 600;
        font-size: 17px;
        padding: 16px 32px;
        min-height: 52px;
        letter-spacing: -0.3px;
        box-shadow: 0 4px 6px rgba(0,122,255,0.15);
    }
    body.theme-rams .mdui-textfield-input {
        border: 2px solid #d2d2d7;
        border-radius: 12px;
        background: #ffffff;
        padding: 16px 20px;
        height: 52px;
    }

    /* Massimo Vignelli ç°ä»£ç½‘æ ¼ä¸»é¢˜ */
    body.theme-vignelli {
        background: #ffffff;
        color: #000000;
        font-family: 'Helvetica Neue Bold', 'Arial Black', sans-serif;
        font-weight: 700;
    }
    body.theme-vignelli .mdui-container {
        max-width: 90vw;
        margin: 0 auto;
        padding: 40px 30px;
    }
    body.theme-vignelli .mdui-card {
        background: #ffffff;
        border: none;
        box-shadow: none;
        border-radius: 0;
        padding: 15px;
        margin: 0 auto 20px auto;
        max-width: 1000px;
        border-top: 6px solid #ff0000;
        border-bottom: 6px solid #0066cc;
    }
    body.theme-vignelli h1 {
        font-size: 42px;
        font-weight: 900;
        text-transform: uppercase;
        letter-spacing: -3px;
        color: #000000;
        text-align: center;
    }
    body.theme-vignelli .mdui-btn {
        background: #000000;
        color: #ffffff;
        border-radius: 0;
        font-weight: 900;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    body.theme-vignelli .mdui-textfield-input {
        border: none;
        border-bottom: 3px solid #000000;
        border-radius: 0;
        font-weight: 700;
    }

    /* Yayoi Kusama æ³¢ç‚¹è‰ºæœ¯ä¸»é¢˜ */
    body.theme-kusama {
        background: #fff0f5;
        color: #d81b60;
        font-family: 'Georgia', serif;
    }
    body.theme-kusama::before {
        background-image: radial-gradient(circle at 20% 80%, rgba(216, 27, 96, 0.08) 0%, transparent 50%);
        animation: kusamaFloat 25s ease-in-out infinite;
    }
    body.theme-kusama .mdui-card {
        background: white;
        border: 3px dotted #d81b60;
        border-radius: 20px;
        padding: 2.5em;
        margin: 2em auto;
        max-width: 95%;
        box-shadow: 0 0 30px rgba(216, 27, 96, 0.2);
    }
    body.theme-kusama .mdui-btn {
        background: linear-gradient(45deg, #d81b60, #ff69b4);
        color: white;
        border-radius: 25px;
        font-weight: 600;
    }
    body.theme-kusama .mdui-textfield-input {
        border: 2px dotted #d81b60;
        border-radius: 20px;
    }

    /* Zaha Hadid æµåŠ¨å‡ ä½•ä¸»é¢˜ */
    body.theme-hadid {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        color: #ffffff;
        font-family: 'Segoe UI', 'Helvetica Neue', sans-serif;
    }
    body.theme-hadid .mdui-card {
        background: rgba(26, 26, 46, 0.85);
        backdrop-filter: blur(15px);
        border: 2px solid rgba(102, 126, 234, 0.3);
        border-radius: 0 15px 15px 0;
        color: #fff;
        margin-bottom: 20px;
    }
    body.theme-hadid .mdui-textfield-input {
        background: rgba(26, 26, 46, 0.7);
        border: 2px solid rgba(102, 126, 234, 0.4);
        border-radius: 0 20px 20px 0;
        color: #ffffff;
    }
    body.theme-hadid h1 {
        background: linear-gradient(45deg, #ffffff, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    /* æ¢¦å¹»æ˜Ÿç©ºä¸»é¢˜ */
    body.theme-starry {
        background: #0a0a1a;
        color: #e0e6ff;
        font-family: 'SF Pro Display', 'Helvetica Neue', 'Arial', sans-serif;
    }
    body.theme-starry .mdui-card {
        background: rgba(15, 23, 42, 0.85);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(147, 197, 253, 0.2);
        border-radius: 24px;
        color: #e0e6ff;
        margin-bottom: 20px;
    }
    body.theme-starry .mdui-btn {
        background: linear-gradient(135deg, #6366f1, #8b5cf6);
        color: #ffffff;
        border-radius: 12px;
    }
    body.theme-starry .mdui-textfield-input {
        background: rgba(15, 23, 42, 0.7);
        border: 2px solid rgba(147, 197, 253, 0.2);
        border-radius: 16px;
        color: #e0e6ff;
    }

    /* é€šç”¨æ ·å¼è¡¥ä¸ */
    .mdui-container {
        max-width: 900px;
        margin-top: 6em;
        margin-bottom: 4em;
    }
    .mdui-card-content { padding: 16px 0 0 0; }
    .mdui-textfield.mdui-textfield-floating-label { display: flex; align-items: center; }
    .mdui-textfield-input, .mdui-btn { margin-right: 8px; }
    .down .mdui-btn { width: auto; margin-left: 1.5em; margin-bottom: 0.5em; }

    /* è®¾ç½®é¢æ¿æ ·å¼ */
    .settings-panel {
        margin-top: 20px;
    }
    .settings-header {
        cursor: pointer;
        user-select: none;
        padding: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: rgba(0,0,0,0.03);
        border-radius: 8px;
    }
    
    /* é’ˆå¯¹æš—è‰²ä¸»é¢˜çš„è®¾ç½®é¢æ¿é€‚é… */
    body.theme-hadid .settings-header, 
    body.theme-starry .settings-header {
        background-color: rgba(255,255,255,0.1);
    }

    @media (max-width: 600px) {
        .mdui-textfield.mdui-textfield-floating-label { flex-direction: column; }
        .mdui-textfield-input, .mdui-btn { margin-right: 0; width: 100%; margin-top: 5px; }
    }
</style>

<div class="theme-selector" id="themeSelector">
    <div class="theme-toggle" onclick="toggleThemeSelector()">
        <span>ğŸ¨ ä¸»é¢˜</span>
        <span id="toggleIcon">â–¼</span>
    </div>
    <div class="theme-options">
        <div class="theme-option active" data-theme="original" onclick="setTheme('original')">
            <div class="theme-preview" style="background: linear-gradient(135deg, #CE9FFC, #7367F0);"></div>
            <div class="theme-name">ç»å…¸MDUI</div>
        </div>
        <div class="theme-option" data-theme="rams" onclick="setTheme('rams')">
            <div class="theme-preview" style="background: #2c3e50;"></div>
            <div class="theme-name">æç®€åŠŸèƒ½</div>
        </div>
        <div class="theme-option" data-theme="vignelli" onclick="setTheme('vignelli')">
            <div class="theme-preview" style="background: linear-gradient(45deg, #ff6b6b, #4ecdc4);"></div>
            <div class="theme-name">ç°ä»£ç½‘æ ¼</div>
        </div>
        <div class="theme-option" data-theme="kusama" onclick="setTheme('kusama')">
            <div class="theme-preview" style="background: #d81b60; border-radius: 50%;"></div>
            <div class="theme-name">æ³¢ç‚¹è‰ºæœ¯</div>
        </div>
        <div class="theme-option" data-theme="hadid" onclick="setTheme('hadid')">
            <div class="theme-preview" style="background: linear-gradient(135deg, #667eea, #764ba2);"></div>
            <div class="theme-name">æµåŠ¨å‡ ä½•</div>
        </div>
        <div class="theme-option" data-theme="starry" onclick="setTheme('starry')">
            <div class="theme-preview" style="background: #1a1a2e;"></div>
            <div class="theme-name">æ¢¦å¹»æ˜Ÿç©º</div>
        </div>
    </div>
</div>

<main class="mdui-container">
    <div class="mdui-card">
        <img class="mdui-img-circle mdui-center" style="width: 150px;" src="https://cdn.jsdelivr.net/gh/5ime/img/avatar.jpg"/>
        <h1 class='mdui-text-center'>åœ¨çº¿çŸ­è§†é¢‘å»æ°´å°è§£æ</h1>
        <div class="mdui-typo">
            <p><strong>ç›®å‰æ”¯æŒ: </strong>æŠ–éŸ³/çš®çš®è™¾/ç«å±±/å¾®è§†/æœ€å³/å¿«æ‰‹/å…¨æ°‘å°è§†é¢‘/çš®çš®æç¬‘/æ¢¨è§†é¢‘/è¥¿ç“œ/å¾®åš/è™ç‰™/ç»¿æ´²/å¥½çœ‹/é€—æ‹/ç¾æ‹/æ–°ç‰‡åœº/Aç«™/å…¨æ°‘Kæ­Œ/6é—´æˆ¿</p>
            <p>
                <strong>æ¸©é¦¨æç¤º: </strong><br/>
                1. ç²˜è´´è§†é¢‘åœ°å€æ—¶<u>æ— éœ€åˆ é™¤æ–‡æ¡ˆ</u><small> ä½†å¦‚æœè§†é¢‘é“¾æ¥æ­£ç¡®ä½†è§£æå¤±è´¥è¯·åˆ æ‰æ–‡æ¡ˆåé‡è¯•</small><br/>
                2. ç‚¹å‡»ä¸‹è½½è§†é¢‘è·³è½¬æ—¶, å¯èƒ½ä¼šè¢«å¯¹åº”ç½‘ç«™è¯†åˆ«, æŠ¥ <u>403 Forbidden</u>, å¯ä»¥åœ¨ ä¸‹è½½è§†é¢‘ æŒ‰é’®, å³é”®å¤åˆ¶é“¾æ¥åœ°å€, æ–°å¼€æµè§ˆå™¨æ ‡ç­¾é¡µæ‰“å¼€å³å¯
            </p>
            <hr/>
        </div>
        <div class="mdui-card-content mdui-typo">
            <div class="mdui-textfield mdui-textfield-floating-label">
                <input class="mdui-textfield-input" type="text" id="url" placeholder="è¯·ç²˜è´´è§†é¢‘åˆ†äº«åœ°å€" required/>
                <div class="mdui-textfield-error">
                    éœ€è¦è§£æçš„è§†é¢‘åœ°å€ä¸èƒ½ä¸ºç©º
                </div>
                <button class="mdui-btn mdui-color-theme-accent mdui-ripple" onclick="setValue()"><span>è§£æ</span></button>
                <button class="mdui-btn mdui-color-red mdui-ripple" onclick="clearInput()"><span>æ¸…ç©º</span></button>
            </div>
        </div>
        <div class="down mdui-text-center"></div>
    </div>

    <div class="mdui-card settings-panel">
        <div class="mdui-collapse" mdui-collapse>
            <div class="mdui-collapse-item">
                <div class="mdui-collapse-item-header settings-header">
                    <div>ğŸ”§ é«˜çº§è®¾ç½® (Cookie ç®¡ç†)</div>
                    <i class="mdui-collapse-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>
                </div>
                <div class="mdui-collapse-item-body">
                    <div class="mdui-card-content">
                        <div class="mdui-typo">
                            <p style="font-size: 14px; opacity: 0.7;">
                                æç¤ºï¼šå½“è§£æå®å†µå›¾æˆ–é«˜æ¸…è§†é¢‘å¤±è´¥æ—¶ï¼Œè¯·åœ¨æ­¤æ›´æ–° PC ç«¯ Cookie (éœ€åŒ…å« ttwid)ã€‚<br>
                                ä»…ç®¡ç†å‘˜å¯ç”¨ã€‚
                            </p>
                        </div>
                        <div class="mdui-textfield mdui-textfield-floating-label">
                            <label class="mdui-textfield-label">ç®¡ç†å‘˜å¯†ç </label>
                            <input class="mdui-textfield-input" type="password" id="adminPwd" placeholder="è¾“å…¥å¯†ç ä»¥éªŒè¯æƒé™"/>
                        </div>
                        <div class="mdui-textfield mdui-textfield-floating-label">
                            <label class="mdui-textfield-label">å®Œæ•´ Cookie å­—ç¬¦ä¸²</label>
                            <textarea class="mdui-textfield-input" id="dyCookie" rows="3" placeholder="åœ¨æ­¤ç²˜è´´ F12 è·å–çš„ Cookie"></textarea>
                        </div>
                        <button class="mdui-btn mdui-btn-raised mdui-ripple mdui-color-blue-grey mdui-m-t-2" onclick="submitCookie()">
                            <i class="mdui-icon material-icons">save</i> æ›´æ–° Cookie
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<script>
// ä¸»é¢˜ç®¡ç†
let currentTheme = localStorage.getItem('selectedTheme') || 'original';

function toggleThemeSelector() {
    const selector = document.getElementById('themeSelector');
    const icon = document.getElementById('toggleIcon');
    selector.classList.toggle('collapsed');
    icon.textContent = selector.classList.contains('collapsed') ? 'â–¶' : 'â–¼';
}

function setTheme(themeName) {
    document.body.className = '';
    if (themeName !== 'original') document.body.classList.add(`theme-${themeName}`);
    document.querySelectorAll('.theme-option').forEach(option => option.classList.remove('active'));
    document.querySelector(`[data-theme="${themeName}"]`).classList.add('active');
    currentTheme = themeName;
    localStorage.setItem('selectedTheme', themeName);
}

// æ¸…ç©ºè¾“å…¥æ¡†
function clearInput() {
    document.getElementById("url").value = "";
}

// è§£æåŠŸèƒ½
function setValue() {
    var data = document.getElementById("url").value;
    if (!data) {
        mdui.snackbar({message: 'è¯·è¾“å…¥é“¾æ¥'});
        return;
    }
    let regex = /http[s]?:\/\/[\w.-]+[\w\/-]*[\w.-]*\??[\w=&:\-\+\%]*[/]*/;
    var match = data.match(regex);
    if (!match) {
        mdui.snackbar({message: 'æœªè¯†åˆ«åˆ°æœ‰æ•ˆé“¾æ¥'});
        return;
    }
    var v = match[0];

    var xmlhttp;
    if (window.XMLHttpRequest) {
        xmlhttp = new XMLHttpRequest();
    } else {
        xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
    }

    // æ˜¾ç¤ºåŠ è½½ä¸­
    const parseBtn = document.querySelector('.mdui-btn.mdui-color-theme-accent');
    const originalText = parseBtn.innerHTML;
    parseBtn.innerHTML = '<span>è§£æä¸­...</span>';
    parseBtn.disabled = true;

    xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState == 4) {
            parseBtn.innerHTML = originalText;
            parseBtn.disabled = false;
            
            if (xmlhttp.status == 200) {
                var jsonObj = JSON.parse(xmlhttp.responseText);
                if (jsonObj.code == 200) {
                    mdui.snackbar({ message: 'è§£ææˆåŠŸ' });
                    renderResult(jsonObj.data);
                } else {
                    mdui.snackbar({
                        message: "è§£æå¤±è´¥: " + jsonObj.msg
                    });
                }
            } else {
                mdui.snackbar({ message: "ç½‘ç»œè¯·æ±‚å¤±è´¥" });
            }
        }
    };

    xmlhttp.open("GET", "/video/share/url/parse?url=" + encodeURIComponent(v), true); // æ”¹ä¸ºå¼‚æ­¥
    xmlhttp.send();
}

function renderResult(data) {
    let successHtml = '<h4>' + data.title + ' </h4>';
    successHtml += '<a class="mdui-btn mdui-btn-raised" href="' + data.cover_url + '" target="_blank" download="cover" referrerpolicy="no-referrer"><span>ä¸‹è½½å°é¢</span></a>';

    if (data.video_url != "") {
        successHtml += '<a class="mdui-btn mdui-btn-raised" href="' + data.video_url + '" target="_blank" download="video" referrerpolicy="no-referrer"><span>ä¸‹è½½è§†é¢‘</span></a>';
    }

    if (data.images && data.images.length > 0) {
        successHtml += "<hr/>";
        successHtml += '<h4>å›¾é›†/å®å†µ</h4>';
        data.images.forEach(function (item) {
            successHtml += '<div style="display: inline-block; margin: 1em; text-align: center;">';
            successHtml += '<img src="' + item.url + '" style="width: 160px; display: block; margin-bottom: 0.5em; cursor:pointer;" onclick="window.open(\''+item.url+'\')"/>';
            if (item.live_photo_url) {
                successHtml += '<a class="mdui-btn mdui-btn-raised mdui-color-pink-accent" href="' + item.live_photo_url + '" target="_blank" download="video" referrerpolicy="no-referrer" style="text-transform: none;"><span>ä¸‹è½½å®å†µè§†é¢‘</span></a>';
            }
            successHtml += '</div>';
        });
    }
    $(".down").html(successHtml);
}

// æäº¤ Cookie åŠŸèƒ½
async function submitCookie() {
    const cookie = document.getElementById('dyCookie').value;
    const password = document.getElementById('adminPwd').value;

    if (!cookie || !password) {
        mdui.snackbar({ message: 'Cookie å’Œå¯†ç ä¸èƒ½ä¸ºç©ºï¼' });
        return;
    }

    try {
        const response = await fetch('/api/update_cookie', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                cookie: cookie,
                password: password
            })
        });

        const res = await response.json();

        if (response.ok && res.code === 200) {
            mdui.snackbar({ message: 'âœ… ' + res.msg });
            // æ¸…ç©ºå¯†ç æ¡†
            document.getElementById('adminPwd').value = '';
        } else {
            mdui.snackbar({ message: 'âŒ ' + (res.detail || res.msg || "æ›´æ–°å¤±è´¥") });
        }
    } catch (error) {
        console.error('Error:', error);
        mdui.snackbar({ message: 'âŒ ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°' });
    }
}

// åˆå§‹åŒ–
window.addEventListener('DOMContentLoaded', function() {
    setTheme(currentTheme);
    if (window.innerWidth <= 600) {
        document.getElementById('themeSelector').classList.add('collapsed');
        document.getElementById('toggleIcon').textContent = 'â–¶';
    }
});
</script>
</body>
</html>